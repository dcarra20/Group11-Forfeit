<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="mobileCSS.css">
    <title>Forfeit - Calendar</title>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Forfeit</h1>
            <div class="profile-icon">
                &#128100;
            </div>
        </div>

        <div class="calendar">
            <div class="calendar-header">
                <button class="arrow-btn" onclick="prevMonth()">&#9664;</button>
                <span id="month-year">MARCH 2025</span>
                <button class="arrow-btn" onclick="nextMonth()">&#9654;</button>
            </div>
            <table class="calendar-table">
                <tr>
                    <th>S</th>
                    <th>M</th>
                    <th>T</th>
                    <th>W</th>
                    <th>T</th>
                    <th>F</th>
                    <th>S</th>
                </tr>
                <tbody id="calendar-body">
                </tbody>
            </table>
        </div>

        <div class="bottom-nav">
            <button class="nav-btn" onclick="navigateTo('mobileHome.html')">Home</button>
            <button class="nav-btn active" onclick="navigateTo('mobileCalendar.html')">Calendar</button>
            <button class="nav-btn" onclick="navigateTo('mobileGoals.html')">Goals</button>
        </div>
    </div>

    <script>
        let currentDate = new Date();

        function navigateTo(page) {
            window.location.href = page;
        }

        function loadCalendar() {
            const calendarBody = document.getElementById('calendar-body');
            const monthYear = document.getElementById('month-year');
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).getDay();
            const lastDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();

            calendarBody.innerHTML = '';

            monthYear.innerText = currentDate.toLocaleString('default', { month: 'long', year: 'numeric' });

            let dayCounter = 1;
            for (let row = 0; row < 6; row++) {
                let tr = document.createElement('tr');
                for (let col = 0; col < 7; col++) {
                    let td = document.createElement('td');

                    if (row === 0 && col < firstDay) {
                        td.classList.add('prev-month');
                        td.innerText = '';
                    } else if (dayCounter > lastDate) {
                        td.classList.add('next-month');
                        td.innerText = '';
                    } else {
                        td.innerText = dayCounter;
                        td.setAttribute('data-day', dayCounter);

                        // âœ… Highlight today's date
                        if (
                            dayCounter === new Date().getDate() &&
                            currentDate.getMonth() === new Date().getMonth() &&
                            currentDate.getFullYear() === new Date().getFullYear()
                        ) {
                            td.classList.add('highlight');
                        }

                        if (isGoalDay(dayCounter)) {
                            td.classList.add('goal-day');
                        }

                        dayCounter++;
                    }

                    tr.appendChild(td);
                }
                calendarBody.appendChild(tr);
            }
        }

        function isGoalDay(day) {
            const goals = JSON.parse(localStorage.getItem('goals')) || [];
            return goals.some(goal => {
                const goalDate = new Date(goal.deadline).getDate();
                const goalMonth = new Date(goal.deadline).getMonth();
                const goalYear = new Date(goal.deadline).getFullYear();
                return (
                    day === goalDate &&
                    goalMonth === currentDate.getMonth() &&
                    goalYear === currentDate.getFullYear() &&
                    !goal.completed
                );
            });
        }

        function prevMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            loadCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            loadCalendar();
        }

        window.onload = loadCalendar;
    </script>
</body>
</html>
